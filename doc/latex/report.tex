\documentclass[letter,12pt,notitlepage]{article}
\usepackage[left=2cm, right=2cm, top=2cm, bottom=2cm]{geometry}
\usepackage[shortlabels]{enumitem}
\usepackage{graphicx}
\usepackage{todonotes}
\usepackage{amsmath}
\usepackage[titletoc,title]{appendix}
\usepackage{amssymb}
\usepackage{makecell}
\usepackage{wrapfig}
\usepackage{verbatim}
\usepackage{listings}
\usepackage{minted}
\usepackage{subfig}
\usepackage{titling}
\usepackage[compatibility=false]{caption}
\usepackage[parfill]{parskip}
\setlength{\droptitle}{1cm}
\usepackage{hyperref}
\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black
}
\usepackage{setspace}
\renewcommand{\topfraction}{0.85}
\renewcommand{\textfraction}{0.1}
\renewcommand{\floatpagefraction}{0.75}
\usepackage[
    %backend=biber, 
    natbib=true,
    style=numeric,
    sorting=none,
]{biblatex}
\addbibresource{citations.bib}
\input{variables.tex}

\setcounter{biburllcpenalty}{7000}
\setcounter{biburlucpenalty}{8000}

\newenvironment{tight_enumerate}{
\begin{enumerate}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
}{\end{enumerate}}

\newenvironment{tight_itemize}{
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
}{\end{itemize}}

\newlength{\mintednumbersep}
\AtBeginDocument{%
  \sbox0{\tiny00}%
  \setlength\mintednumbersep{8pt}%
  \addtolength\mintednumbersep{-\wd0}%
}

\title{\ThesisTitle}

\author{\vspace{1em}\\Sevag Hanssian \\
  McGill University \\
 \small{\texttt{sevag.hanssian@mail.mcgill.ca}} \\
 \small{\texttt{sevagh@protonmail.com}} \\\ \\\ \\
 \small{Thesis for Master of Arts in Music Technology}\\
 \small{Date TBD, 2021}}

% nil out the auto date
\date{}

\begin{document}

\maketitle

\vspace{3.5em}

\begin{abstract}
	The discrete Fourier transform (DFT), and the Fast Fourier Transform (FFT) algorithm for its efficient computation, rank among the most important algorithms in applied engineering and computer science in the modern world. The FFT is used in digital signal processing applications such as audio, seismology, and medical imaging to decompose a signal into a sum of its frequency components. This thesis first describes the DFT and FFT, their use in music systems, and several variants which may be beneficial for music applications. Next, a new software library is proposed which implements the FFT variants with an interface designed to be a drop-in replacement of the standard FFT. Finally, the variants are substituted in two recent state-of-the-art music systems, showing reduced computational footprint and an improvement in accuracy.
\end{abstract}

\vfill
\clearpage %force a page break

\tableofcontents

\vfill
\clearpage %force a page break

\listoffigures

\listoflistings

\vfill
\clearpage %force a page break

\section{Introduction}
\label{sec:intro}

\todo[inline]{core axioms here}

The DFT and FFT \cite{cooleytukey} are important \cite{dftimportant}. \todo{more stuff here}. Despite its importance, the DFT has some deficiencies in real-world music applications.

First, the human auditory system has a nonlinear frequency resolution, with finer frequency discrimation at low frequencies \todo{cite this}, but the DFT outputs linearly-spaced frequencies.

Second, real-world signals are typically sparse, with most of their energy concentrated in few frequency components \cite{sparseintro}, yet the DFT outputs values for many frequencies, most of which are discarded.

\subsection{Motivation}

Music, speech, and general signal processing literature often show improved results by substituting the standard DFT with a variant. Examples include improved music source separation \cite{betterbss}, improved speech recognition \cite{bettermfcc}, and better speech and music coding \cite{warpedcomparison} with the warped Fourier transform, and reduced acquisition time and artifacts for medical magnetic resonance with the sparse Fourier transform \cite{bettersparse}.\todo[inline]{find more compelling musical use cases here, not medical - trawl ismir dafx etc.}

However, implementations of these variants are not readily found or available in common DFT/FFT software libraries, which may be a barrier to their use in music and audio research. Popular software libraries implementing the FFT, including FFTW\footnote{\href{http://www.fftw.org/}{http://www.fftw.org/}} \cite{fftw1}, ffts\footnote{\href{https://github.com/anthonix/ffts/}{https://github.com/anthonix/ffts/}} \cite{ffts}, numpy\footnote{\href{https://numpy.org/doc/stable/reference/routines.fft.html}{https://numpy.org/doc/stable/reference/routines.fft.html}} \cite{numpy}, scipy\footnote{\href{https://docs.scipy.org/doc/scipy/reference/tutorial/fft.html}{https://docs.scipy.org/doc/scipy/reference/tutorial/fft.html}} \cite{scipy}, and hardware-specific libraries such as Intel Performance Primitives\footnote{\href{https://software.intel.com/content/www/us/en/develop/documentation/ipp-dev-reference/top/volume-1-signal-and-data-processing/transform-functions/fourier-transform-functions/fast-fourier-transform-functions.html}{https://software.intel.com/content/www/us/en/develop/documentation/ipp-dev-reference/top/volume-1-signal-and-data-processing/transform-functions/fourier-transform-functions/fast-fourier-transform-functions.html}} (IPP) \cite{ipp}, cuFFT\footnote{\href{https://docs.nvidia.com/cuda/cufft/index.html}{https://docs.nvidia.com/cuda/cufft/index.html}} \cite{cufft}, and Ne10\footnote{\href{https://projectne10.github.io/Ne10/doc/group__groupDSPs.html}{https://projectne10.github.io/Ne10/doc/group\_\_groupDSPs.html}} for Arm processors \cite{ne10} only contain the standard FFT algorithms.

New FFT libraries try to improve the performance of the FFT with new processor instructions\footnote{\href{https://github.com/DEWETRON/otfft}{https://github.com/DEWETRON/otfft}} or by using faster and safer programming languages like Rust.\footnote{\href{https://users.rust-lang.org/t/rustfft-5-0-0-experimental-1-now-faster-than-fftw/53049}{https://users.rust-lang.org/t/rustfft-5-0-0-experimental-1-now-faster-than-fftw/53049}} While performance is an important aspect of software libraries, it is not the only one. The authors of FFTW state that ``[f]lexibility [for scientific computing libraries] is often far more important [than speed], because one wants to be limited only by one's imagination, rather than by one's software, in the kinds of problems that can be studied  \cite{fftw2}.'' In this thesis, I seek to provide a flexible choice of alternative FFTs for future music research.

\subsection{Thesis objective}

The primary objective of this thesis is to write a library which implements variants of the FFT that may be useful for music systems. The interface of the library should resemble the standard FFT as closely as possible, to reduce the friction of substituting any of the variants in existing systems. FFTW justifies their use of the C programming language as follows \cite{fftw2}:

\begin{quote}
	[the user-callable interface of FFTW is] purely in C with lowest-common-denominator data types (arrays of floating-point values). The advantage of this is that FFTW can be (and has been) called from almost any other programming language, from Java to Perl to Fortran 77. Similar lowest-common-denominator interfaces are apparent in many other popular numerical libraries, such as LAPACK.
\end{quote}

For the same reason of maximum compatibility with programming languages, the core library of this thesis will be written in C. Python bindings will be written as well released initially as it's \todo{unfuck and cite this} the language of choice for numeric computing/prototyping and especially machine and deep learning. 

An explicit non-goal of this thesis is rewriting the FFT. The most typical computation scheme of an FFT variant involves optional pre-processing, the application of a standard FFT, and optional post-processing. For example, \citet{sparse} uses FFTW, NUFFT uses FFTW, and the scheme for the warped Fourier transform uses the FFTW. The FFT implementation that will be used in fftn is \todo{maybe not ffts!} ffts, for its more liberal open-source license. \todo[inline]{of course make this better} It will be vendored also.

The secondary objective of this thesis is to substitute the implemented variants in a state-of-the-art music system, to determine whether.

\subsection{Related work}

foo

\subsection{Contribution and results}

The primary contribution of this thesis is the creation and open-source publication of a new Fourier transform library,\footnote{\href{https://github.com/sevagh/fftn}{https://github.com/sevagh/fftn}} named fftn, which stands for a \textit{Fast Fourier Transforms from the North}. \todo{building on ffts} The name is chosen in the same spirit as FFTW \cite{fftw1} (Fastest Fourier Transform in the West), created at the Massachusetts Institute of Technology (MIT) in the United States and named after the ``Fastest Gun in the West'' from movies about the American Wild West.\footnote{\href{http://www.fftw.org/faq/section1.html\#west}{http://www.fftw.org/faq/section1.html\#west}} Another project named along these lines is ffts \cite{ffts} (Fastest Fourier Transform in the South), created at The University of Waikato in New Zealand which is located in the southern hemisphere of the world. The goal of my library is not to further optimize the FFT, but to gather many variants of the FFT in a single place. The pluralization of the word \textit{transforms} denotes the different FFT variants, and the library is from the north because I created it in my city of Montr{\'e}al, Canada (which is further north than New Zealand or Massachusetts).

A secondary contribution of this thesis showed that substituting variants of FFT in a recent music system \todo{PICK SOTA!} showed a simultaneous reduction of the computational footprint and accuracy of results. This indicates that the use of these variants could be a promising avenue for future research, and it is hoped that the fftn library will become an important tool in future music systems.

\subsection{Outline}

This thesis is organized as follows. Section \ref{sec:theorystandard} will cover the theory of the DFT and its fast FFT implementation, and their use in music systems. Section \ref{sec:theoryvariant} will describe several variants of the FFT that may be useful for music applications. Section \ref{sec:libraries} will describe and benchmark existing open-source FFT libraries, and develop a new FFT library containing implementations of the studied variants. Section \ref{sec:results} will describe the outputs and performance analysis of the variants in the new library, as well as results achieved in a real-world music system by substituting the standard FFT with each variant. Finally, section \ref{sec:conclusion} will discuss the findings and explore whether there is value in using a variant instead of the standard FFT when creating new music systems.

\vfill
\clearpage

\section{The Fourier transform}
\label{sec:theorystandard}

\qquad \textit{abbreviations:} DFT (discrete Fourier transform), DTFT (discrete-time Fourier transform), FFT (Fast Fourier transform)

\todo[inline]{theory of fourier, history, continuous-time fourier transform}

\subsection{Discrete Fourier transform}

\todo[inline]{digital sampling theory intro, then map ct to dt}

A characteristic of the standard DFT is that the output frequencies are evenly spaced. For an $N$-point DFT, the DFT coefficient at bin (or index) 0 corresponds to the DC component of the sound, and every non-zero coefficient corresponds to a frequency $\frac{n}{\mathit{fs}}, n \in (0, N)$, where $\mathit{fs}$ is the sampling rate of the input signal. In practice, since frequencies above the Nyquist rate cannot be represented, the useful bins of a DFT are between $1$ and $\frac{N}{2}+1$, representing the frequencies $\frac{1}{\mathit{fs}}$ Hz and $\frac{\mathit{fs}}{2} = f_{\text{nyq}}$ Hz. Each bin in between is spaced $\frac{1}{\mathit{fs}}$ apart from the previous and next bin.

\todo[inline]{unit circle z plane blah}

\subsection{Fast Fourier transform}

\citet{cooleytukey} did a cool thing. Bluestein? stockham? so many

\subsection{The Fourier transform in music systems}

\subsubsection{Musical and psychoacoustic frequency scales}
\label{sec:freqscales}

\todo[inline]{mel, bark power summation/PSD}

\todo[inline]{constant-Q and octave}

The human auditory system has a non-linear frequency response, with a finer frequency resolution at lower frequencies. \todo{BCJ Moore or Plack} This has implications in both speech and music processing. In music, low frequency bass notes establish the harmonic basis of a song. \todo{doerfler}

\todo[inline]{nice psychoacoustic diagrams here}

A common approach is to apply post-processing on the linear frequencies of the spectrogram output by the standard DFT to modify the scale to logarithmic, or the mel or Bark psychoacoustic frequency scales \todo{cite psychoacoustic scales}. Figure \ref{fig:melfilter} from the MATLAB documentation\footnote{\href{https://www.mathworks.com/help/audio/ref/melspectrogram.html}{https://www.mathworks.com/help/audio/ref/melspectrogram.html}} shows the computation of a mel spectrogram from the standard FFT as described by \citet[463]{melbook}.

\todo[inline]{BY SUMMING THE POWER SPECTRAL DENSITIES! so we can't just output frequencies at the isolated edges of the mel bands}

\begin{figure}[ht]
	\centering
	\subfloat[Computation of mel spectrogram]{\includegraphics[width=11cm]{./melspectrogram_1.png}}
	\subfloat[DFT weighting functions for mel scale]{\includegraphics[height=3cm]{./melspectrogram_2.png}}
	\caption{Computation of mel spectrogram}
	\label{fig:melfilter}
\end{figure}

Instead of post-processing the standard DFT to map to a psychoacoustic frequency scale, one option is to use a variant of the DFT which outputs the psychoacoustic frequencies directly. This may lead to significant computational savings in systems. The nonuniform DFT (NDFT) and warped DFT (WDFT) are two such possibilities.


\subsubsection{Time-frequency analysis, spectrum, and cepstrum}

spectrograms, etc.

\subsubsection{Correlation and convolution}

\vfill
\clearpage

\section{Variants of the Fourier transform}
\label{sec:theoryvariant}

These useful ones will be covered.

\subsection{Nonuniform and warped DFT}

\qquad \textit{abbreviations:} NFT (nonuniform Fourier transform), NUFFT (nonuniform FFT), NDFT (nonuniform DFT), WDFT (warped DFT), WDLDFT (warped delay line DFT)

The variant of the DFT which can output arbitrarily-spaced frequencies is the nonuniform (or nonequispaced) DFT, also referred to as the NFT (nonuniform Fourier transform), NDFT (nonuniform discrete Fourier transform), and NUFFT (nonuniform Fast Fourier transform). The most recent implementation of the NUFFT is by \citet{nufft1} with source code available,\footnote{\href{https://finufft.readthedocs.io/en/latest/index.html}{https://finufft.readthedocs.io/en/latest/index.html}} which in turn derives from earlier work \cite{nufft2, nufft3}.

A special case of the nonuniform DFT is the warped DFT. In the warped DFT, the uniformly-spaced DFT is applied to a signal on a warped frequency scale. Those uniformly-spaced frequencies on the warped frequency scale then correspond to nonuniformly-spaced frequencies on the original frequency scale. This implementation is known as the warped DFT (WDFT) \cite{warped1}, and it is a generalization of the nonuniform DFT \cite{nufft3}.

\citet{warped2} provides for improved computational efficiency for the forward WDFT, and an iterative inverse WDFT (IIWDFT) computation scheme to approximate the inverse transform with low errors.

\todo[inline]{bilinear mapping, cubic spline, invertibility}
warping stuff here? bark erb blah blah

As described by \citet{warpedcomparison} in their paper comparing different warped Fourier transform implementations, a previous approach to the warped DFT \cite{earlywarped1, earlywarped2} was to apply an allpass network (or warped delay line) to the input signal $x[n]$ to a new frequency-warped sequence $y[n]$, and then apply the standard DFT (they name the old approach the WDLDFT, or warped delay line DFT, while WDFT refers to the method based on the NDFT). The WDFT and WDLDFT filterbanks are shown in figure \ref{fig:wdfts}.

\begin{figure}[ht]
	\centering
	\subfloat[WDFT filterbank\label{fig:wdftsa}]{{\includegraphics[height=5cm]{./wdft.png} }}
	\subfloat[WDLDFT filterbank\label{fig:wdftsb}]{{\includegraphics[height=5cm]{./wdldft.png} }}
	\caption{Two approaches to the warped DFT}
	\label{fig:wdfts}
\end{figure}

\citet{warped1} describe that the WDLDFT approach leads only to an approximation of the warped-frequency magnitudes, while the WDFT leads to an exact solution. Additionally, \citet{warpedcomparison} found that in their psychoacoustic audio coding experiments, the WDFT and WDLDFT both performed better than the standard DFT for coding stationary signals like bagpipes, but found that the WDFT performed better on transient attack signals like castanets due to its better time resolution. Therefore, the implementation of the WDFT in this thesis will be the version based on the NDFT \cite{warped1}, taking into account the most recently proposed implementation details \cite{warped2}.

\subsubsection{Relation to the Constant-Q transform}

The idea for a musically-appropriate single transform, the Constant-Q Transform, was first proposed by \citet{jbrown}. The goal was to create a transform which maintained a constant ratio of frequency to frequency resolution, for the following reasons:

\begin{tight_itemize}
	\item
		The harmonics of the fundamental frequency created by musical instruments have a consistent spacing in the logarithmic scale, or the \textit{constant pattern}
	\item
		Log-frequency spectra, demonstrating the constant pattern for harmonics, would be more useful in musical tasks than linear-frequency spectra
\end{tight_itemize}

This is illustrated in figure \ref{fig:violin}, showing a linear and CQT representation of violin playing a scale. Note that the musical features of the violin -- distinct notes played, even spacing between the harmonics, and the strong formant frequency in the \textasciitilde3000 Hz region -- which are clearly visible in the CQT, and not in the linear-frequency DFT.

\begin{figure}[ht]
	\centering
	\subfloat[Linear-frequency DFT]{\includegraphics[height=5.2cm]{./violindft.png}}
	\hspace{0.5em}
	\subfloat[Constant-Q transform]{\includegraphics[height=5.5cm]{./violincqt.png}}
	\caption{Violin playing the diatonic scale, $G_{3} \text{(196Hz)} - G_{5} \text{(784Hz)}$}
	\label{fig:violin}
\end{figure}

\todo[inline]{describe puckette brown cqt with FFT operations}

\todo[inline]{cite here the good time resolution of the 2-dictionary CQT, dorfler stuff thesis}

The first formulation of the CQT was constructed using specific window sizes for each frequency region of interest, and was not designed to be invertible, thus making it only suitable for analysis.

Several papers created CQT implementations with some level of approximation error in the inverse transform \cite{klapuricqt, fitzgeraldcqt}. In fact, \citet{klapuricqt}'s implementation is currently the implementation of the CQT in librosa \cite{librosa}, a popular and modern open-source Music Information Retrieval library for Python.

Subsequent work by \citet{balazs, jaillet, invertiblecqt} applied formal frame theory to create a perfectly invertible and minimally redundant Constant-Q transform using the Nonstationary Gabor Transform (NSGT, or NSDGT for the discrete-time variant). The CQ-NSGT is the implementation of the CQT in the MATLAB Wavelet Toolbox.\footnote{\href{https://www.mathworks.com/help/wavelet/ref/cqt.html}{https://www.mathworks.com/help/wavelet/ref/cqt.html}} \todo[inline]{deal with number of FFTs in the computation}

In their CQT paper, \citet{klapuricqt} reference the warped DFT from \citet{warpedold1, warpedold2} as an interesting option for a CQT, but ruled it out for lacking a stable inverse transform. Those implementations are in fact similar to those already mentioned \cite{earlywarped1, earlywarped2} in that they use the warped delay line (WDLDFT) implementation, shown previously in figure \ref{fig:wdftsb}. Therefore, \citet{warped2}'s WDFT with the low error IIWDFT inversion scheme may be a better choice as an alternative to the CQT.

\subsection{Sparse and pruned DFT}

A statement on pruned FFTs from the fftw website\footnote{\href{http://www.fftw.org/pruned.html}{http://www.fftw.org/pruned.html}} recommends ``not bothering to consider a pruned 1d FFT,'' since the computational cost savings of pruning may not be worth losing the optimization of the regular FFT for the 1-dimensional case (it is a different story for 2d or higher dimension Fourier transforms, but those are not used for music analysis). This thesis also seeks to revisit this idea, to see whether sparse or pruned FFTs for 1-dimensional audio signals are worth using. In machine or deep learning systems, thousands and thousands of FFTs are computed for large amounts of audio training data, and my hypothesis is that seemingly negligible computational savings for small 1d FFTs might stack up when performing many of them.

Hassanieh et al say that k now only has to be a little less than n, not very less - \todo{tie into fftw}

 could lead to even better results, such as the sparse or pruned FFTs which compute a $k$-point FFT in $O(k \log n)$ time where $k << n$, assuming that those $k$ frequency components are more important than the full $n$ outputs of the regular FFT.

\vfill
\clearpage

\section{Fourier transform libraries}
\label{sec:libraries}

foo

\subsection{Existing libraries}

foo

\subsection{Designing a new library}

foo

\subsection{Performance optimizations}

foo

\subsection{Benchmarks}

foo

\vfill
\clearpage

\section{Results}
\label{sec:results}

foo

\subsection{Library usage and outputs}

foo

\subsection{Memory footprint}

foo

\subsection{Computational footprint}

foo

\subsection{Substitution in a real-world music system}

foo

\vfill
\clearpage

\section{Conclusions}
\label{sec:conclusion}

foo

\subsection{Evaluation}

foo

\subsection{Outlook}

foo

\subsection{Summary}

foo

\vfill
\clearpage % force a page break before references

%\nocite{*}
\section{References}
\printbibliography[heading=none]

\vfill
\clearpage %force a page break

\begin{appendices}

\section{Extra stuff}
\label{appendix:rthpss}

\end{appendices}

\end{document}
